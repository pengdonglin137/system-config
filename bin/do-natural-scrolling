#!/bin/bash

set -e

base0=$(basename $0)

if test "$base0" = do-natural-scrolling; then
    xmodmap -e 'pointer = 1 2 3 5 4 6 7 8 9 10'
    symbol=-
    natural_enabled=1
    if test "${USER}" = bhj; then
        bhj-notify mouse "you specified natural scrolling"
    fi
else
    xmodmap -e 'pointer = 1 2 3 4 5 6 7 8 9 10'
    symbol=
    natural_enabled=0
    if test "${USER}" = bhj; then
        alarm 0m "You are trying to do unnatural scrolling"
        bhj-notify mouse "you specified unnatural scrolling"
    fi
fi

# FIXME： 这后面的脚本有点复杂，我希望自己搞清楚到底哪些窗口需要做这些
# 额外的设置并记录下来。

devices=$(xinput -list|grep pointer|perl -ne 'print "$1\n" if m/id=(\d+)/')
if xinput list-props $devices | grep -q 'libinput Natural Scrolling Enabled'; then
    xmodmap -e 'pointer = 1 2 3 4 5 6 7 8 9 10'
fi
for device in $devices; do
    xinput set-prop "$device" "libinput Natural Scrolling Enabled" $natural_enabled ||
        xinput set-prop "$device" "Evdev Scrolling Distance" ${symbol}1 ${symbol}1 ${symbol}1 ||
        xinput set-prop "$device" "Synaptics Scrolling Distance" ${symbol}112 ${symbol}112 || true
done 2>&1 | if echo $SHELLOPTS | grep -q xtrace; then
    cat
else
    cat > /dev/null
fi
